{% extends "base.html" %}

{% block title %}搜索 - MicroPython MIP 仓库{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="mb-3">搜索包</h1>
        
        <form action="{{ url_for('search') }}" method="get" class="mb-4">
            <div class="input-group input-group-lg">
                <input type="search" name="q" class="form-control" 
                       placeholder="输入包名或描述进行搜索..." 
                       value="{{ query }}" required>
                <button class="btn btn-primary" type="submit">
                    <i class="bi bi-search"></i> 搜索
                </button>
            </div>
        </form>
        
        {% if query %}
        <div class="alert alert-light">
            搜索 "<strong>{{ query }}</strong>" 的结果：
            {% if results %}
                找到 {{ results|length }} 个包
            {% else %}
                没有找到相关包
            {% endif %}
        </div>
        
        {% if results %}
        <div class="row">
            {% for package in results %}
            <div class="col-md-4 mb-4">
                <div class="card package-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">
                            <a href="{{ url_for('package_detail', name=package.name) }}" class="text-decoration-none">
                                {{ package.name }}
                            </a>
                            <span class="badge bg-primary version-badge">{{ package.version }}</span>
                        </h5>
                        <p class="card-text text-muted">
                            {% if package.description %}
                                {{ package.description[:100] }}{% if package.description|length > 100 %}...{% endif %}
                            {% else %}
                                暂无描述
                            {% endif %}
                        </p>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">
                                <i class="bi bi-person"></i> {{ package.owner_name }}
                            </small>
                            <small class="text-muted">
                                <i class="bi bi-clock"></i> {{ package.created_at[:10] }}
                            </small>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent">
                        <a href="{{ url_for('package_detail', name=package.name) }}" class="btn btn-sm btn-outline-primary">
                            查看详情
                        </a>
                        <a href="{{ url_for('download_package', name=package.name, version=package.version) }}" 
                           class="btn btn-sm btn-outline-success">
                            <i class="bi bi-download"></i> 下载
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="bi bi-search" style="font-size: 3rem; color: #6c757d;"></i>
            <h3 class="mt-3">没有找到相关包</h3>
            <p class="text-muted">尝试使用其他关键词搜索，或上传一个新包</p>
            {% if user %}
            <a href="{{ url_for('upload') }}" class="btn btn-primary mt-2">
                <i class="bi bi-upload"></i> 上传新包
            </a>
            {% endif %}
        </div>
        {% endif %}
        {% endif %}
    </div>
</div>
{% endblock %}